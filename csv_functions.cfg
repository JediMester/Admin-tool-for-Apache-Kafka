#!/bin/bash
#!/usr/bin/perl -w

### CSV fájl beolvasására szolgáló függvények:

# Nincs .csv fájl

declare -a sh_files=()
#declare -a topics=()

function task_options() {
	
	echo ""
	printf "%s\n" \
	"Action lehetőségek: " \
	"${YEL}1. User ACL lekérdezés" \
	"2. Üzenet produce-olás topic-ra" \
	"3. Üzenet consume-olás topic-ról" \
	"4. Utolsó offset száma partíciónként" \
	"5. Jogosultság állítás" \
	"6. Jogosultság állítás transactionalID-val" \
	"7. Partíció szám állítás" \
	"8. Retention period állítás" \
	"9. Offset reset" \
	"10. Offset törlés" \
	"11. Topic describe-olás" \
	"12. Rolling restart" \
	"13. Kafka service: stop & disable" \
	"14. Kafka service: start & enable" \
	"15. Egyedi command megadása (új login shell-ben - experimental shit)" \
	"16. Topic(ok) törlése" \
	"17. Jogosultság(ok) elvétele/törlése${NC}" \
	"${LBL}w. VISSZA a welcome page-re${NC}" \
	"${GRE}t. VISSZA a task lehetőségekhez${NC}" \
	"${RED}k. KILÉPÉS${NC}"
	echo ""
	
	read -p "Kérlek válassz egyet: " action

}

function no_csv_provided() {
	# User input-ok bekérése --> nincs .csv
	create_log_dir
	
	#echo "${LBL}Nincs .csv fájl, ezért további user input szükséges.${NC}"
	
	# Ticket számának bekérése
	printf "%s\n" \
	"" \
	"Van releváns ticket szám?" \
	"${YEL}1. Van" \
	"2. Nincs${NC}" \
	""
	
	read -p "Válasz: " ticket_or_not
	echo ""
	case ${ticket_or_not} in
	1)
		read -p "Ticket száma: " ticket_num
	
		is_logging_on
	
		sh_mgmt
		
		task_options
		;;
	2)
		task_options
		;;
	esac
	
	case $action in
	1)
		printf "%s\n" \
		"${YEL}1. Tömeges ACL lekérdezés (.csv fájlból)" \
		"2. Szimpla ACL lekérdezés${NC}" \
		""
		
		read -p "Válasz: " complex_or_simple
		
		case $complex_or_simple in
		2)
			acl_inputs
		
			validate_environment "$env"
			echo ""
			
			#get_user_acl
			get_user_acl >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Helyes az ACL parancs?${NC}" \
			"1. ${RED}Nem, javítom${NC}" \
			"2. ${GRE}Igen, durranhat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				acl_inputs
				
				get_env
				
				choose_zookeeper
				
				validate_environment "$env"
			
				get_user_acl >> $sh_file
				sh_files+=("$sh_file")
				cat $sh_file
				
				echo ""
				printf "%s\n" \
				"${YEL}Most már durroghat a parancs?${NC}" \
				"1. ${RED}Nem${NC}" \
				"2. ${GRE}Igen, durroghat${NC}" \
				""
				read -p "Válasz: " answer
				
				case $answer in
				1) 
					exit_or_restart_or_new_task
					#exit 1
					;;
				2)
					echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
					echo ""
					"$sh_file"
					
					exit_or_restart_or_new_task
					;;
				esac
				;;
		
			
			2)
				#"$kafka_acls_path" --authorizer-properties zookeeper.connect="$selected_zookeeper" --list --principal User:"$user"
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			
			esac
		
			;;	
		
		1)
			acl_csv=""
			
			get_env
				
			choose_broker
			
			if [[ ! -d $acl_dir ]]; then
				mkdir -p $acl_dir
				chown -R kafka:kafka "$acl_dir"
			fi
			
			printf "%s\n" \
			"${YEL}1. ACL user szerint" \
			"2. ACL topic szerint${NC}" \
			""
		
			read -p "Válasz: " user_or_topic
			echo ""
			
			echo "Belépés a ${LBL}$acl_dir${NC} mappába..."
			sleep 0.5
				
			cd "$acl_dir" && pwd && ls -alh
			read -p "Kérlek válaszd ki a .csv fájlodat az ACL task-hoz: " acl_csv
			
			IFS=$'\n' read -d '' -r -a acl_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$acl_csv")
			unset IFS
			
			if [[ ! -z "$acl_csv" ]]; then
				acl_with_csv_name="/home/kafka/kafka-admin-tool/ticketek/acl_dir/${acl_csv}_${current_date}"
				acl_file="$acl_with_csv_name"
			
				touch "$acl_file"
		
				chmod +rwx "$acl_file"
				
			fi
			
			for line in ${acl_complex[@]}; do
			user="$(echo "$line" | awk -F ';' '{print $1}')"
			topic="$(echo "$line" | awk -F ';' '{print $2}')"
			
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] ;}; then
					continue
				fi
				
			get_acl_complex >> "$acl_file"
			
			done
			
			echo "A(z) ${YEL}Az ACL parancsokat tartalmazó fájl: $acl_file${NC}"
			
		;;
		
		esac
		;;
			
	2)
		get_env
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
	
		validate_environment "$env"
		
		produce_message_inputs
		
		produce_message >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes az üzenet produce-olós parancs?{NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			produce_message_inputs
	
			get_env
		
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
	
			validate_environment "$env"
		
			produce_message >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		
		;;
		
	3)
		get_env
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
	
		validate_environment "$env"
		
		consume_message_inputs
		
		consume_message >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes az üzenet consume-olós parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			consume_message_inputs
	
			get_env
		
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
	
			validate_environment "$env"
		
			consume_message >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
	4)
		get_env
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
	
		validate_environment "$env"
		
		partition_offset_inputs
		
		last_offset_per_partition >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes a parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			get_env
		
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
		
			validate_environment "$env"
			
			partition_offset_inputs
			
			last_offset_per_partition >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
		
	6)
		modify_rights_inputs
		read -p "Transactinal ID: " transactional_id
		
		#if [[ "$kafka_version" == "2.7.0" ]]; then
		#
		#	choose_zookeeper
		#else
		#	choose_broker
		#fi
		
		choose_zookeeper
		
		validate_environment "$env"
		
		add_modify_rights_no_csv_with_transactionalid
		;;
	5)
		modify_rights_inputs
		
		get_env
		
		#if [[ "$kafka_version" == "2.7.0" ]]; then
		#
			choose_zookeeper
		#else
			#choose_broker
		#fi
		
		#choose_broker
	
		validate_environment "$env"
		
		add_modify_rights >> "$sh_file"
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes a jogosultság állítós parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			modify_rights_inputs
	
			get_env
		
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
	
			validate_environment "$env"
		
			add_modify_rights >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;	
	
	7)
		topic_only_inputs_no_csv
		
		get_env
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
	
		validate_environment "$env"
		
		modify_topic_partitions >> $sh_file
		
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes a partíció módosítós parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			topic_only_inputs_no_csv
		
			get_env
			
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
		
			validate_environment "$env"
			
			modify_topic_partitions >> $sh_file
		
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
		
	8)
		topic_only_inputs_no_csv
		
		get_env
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
	
		validate_environment "$env"
		
		modify_retention_no_csv >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes a retention módosítós parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			topic_only_inputs_no_csv
		
			get_env
			
			if [[ "$kafka_version" == "2.7.0" ]]; then
			
				choose_zookeeper
			else
				choose_broker
			fi
		
			validate_environment "$env"
			
			modify_retention_no_csv >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
		
	9)
		offset_inputs
		
		get_env
		
		choose_broker
	
		validate_environment "$env"
		
		reset_offsets >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes az offset reset-elő parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			offset_inputs
		
			get_env
		
			choose_broker
	
			validate_environment "$env"
		
			reset_offsets >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
	10)
		offset_inputs
		
		get_env
		
		choose_broker
		
		validate_environment "$env"
		
		delete_offsets >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes az offset törlő parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1) 
			offset_inputs
		
			get_env
		
			choose_broker
		
			validate_environment "$env"
		
			delete_offsets >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
			
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
			
		esac
		;;
	
	11)
		desc_topic_inputs
			
		get_env
		
		choose_broker
		
		validate_environment "$env"
		
		describe_topic >> $sh_file
		sh_files+=("$sh_file")
		cat $sh_file
		
		echo ""
		printf "%s\n" \
		"${YEL}Helyes a topic describe parancs?${NC}" \
		"1. ${RED}Nem, javítom${NC}" \
		"2. ${GRE}Igen, durranhat${NC}" \
		""
		read -p "Válasz: " answer
		
		case $answer in
		1)
		
			desc_topic_inputs
			
			get_env
			
			choose_broker
			
			validate_environment "$env"
			
			describe_topic >> $sh_file
			sh_files+=("$sh_file")
			cat $sh_file
		
			echo ""
			printf "%s\n" \
			"${YEL}Most már durroghat a parancs?${NC}" \
			"1. ${RED}Nem${NC}" \
			"2. ${GRE}Igen, durroghat${NC}" \
			""
			read -p "Válasz: " answer
			
			case $answer in
			1) 
				exit_or_restart_or_new_task
				#exit 1
			    ;;
			2)
				echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
				echo ""
				"$sh_file"
				
				exit_or_restart_or_new_task
				;;
			esac
			;;
			
		2)
			echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
			echo ""
			"$sh_file"
			
			exit_or_restart_or_new_task
			;;
		
		esac
		;;
	
	12)
		rolling_restart
		#get_all_active_brokers
		
		exit_or_restart_or_new_task
		;;
	
	13)
		printf "%s\n" \
		"${YEL}Biztosan mehet a stop + disable task?" \
		"1. Igen, mehet" \
		"2. Nem, zúzás vissza${NC}" \
		""
		read -p "Válasz: " option
		case ${option} in
		1)
			get_env
			
			if { [[ ${env} == "pp" ]] || [[ ${env} == "pr" ]] ;}; then
			printf "%s\n" \
			"Melyik site álljon le?" \
			"1. lajos" \
			"2. babér" \
			""
			read -p "Válasz: " dc_option
			fi
			
			stop_and_disable_kaf
			;;
		2)
			task_options
			;;
		esac
		;;
	
	14)
		printf "%s\n" \
		"${YEL}Biztosan mehet a start + enable task?" \
		"1. Igen, mehet" \
		"2. Nem, zúzás vissza${NC}" \
		""
		read -p "Válasz: " option
		case ${option} in
		1)
			get_env
			
			if { [[ ${env} == "pp" ]] || [[ ${env} == "pr" ]] ;}; then
			printf "%s\n" \
			"Melyik site induljon el?" \
			"1. lajos" \
			"2. babér" \
			""
			read -p "Válasz: " dc_option
			fi
			
			start_and_enable_kaf
			;;
		2)
			task_options
			;;
		esac
		;;
	
	15)
		${kat_dir}new_shell_spawn.sh
		;;
		
	17)
		#printf "%s\n" \
		#"${YEL}1. 1 topic-on 1 vagy több különböző jog elvétele" \
		#"2. Több topic-on 1 vagy több különböző jog elvétele${NC}" \
		#""
		#
		#read -p "Válasz: " answer
		#
		#case $answer in
		
		modify_rights_inputs
		
		choose_zookeeper
		
		validate_environment "$env"
		
		delete_rights >> "$sh_file"
		
		echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
		echo ""
			
		exit_or_restart_or_new_task
		;;
		
	16)
		desc_topic_inputs
		
		choose_broker
		
		validate_environment "$env"
		
		delete_topic >> "$sh_file"
		
		echo "A parancsot tartalmazó .sh fájl: ${LBL}$sh_file${NC}"
		echo ""
		
		exit_or_restart_or_new_task
		;;
	
	w)
		lets_work
		;;
	
	t)
		work_options
		;;
		
	k)
		xIT
		;;
	
	*)
		echo "Hiba: nem adtál meg semmilyen eksönt!"
		#exit 1
		
		exit_or_restart_or_new_task
		;;
	esac

}

# Simple .csv fájl van megadva

function simple_csv() { 
	
	create_log_dir

	sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$csv_file"
	
	echo "${LBL}A ${csv_file_path} fájl beolvasva.${NC}"
  
	#get_kaf_ver
	
	#echo "${LBL}A cluster-en jelenleg futó Kafka verzió:${NC} ${YEL}$kafka_version${NC}"
	
	# Ticket számának bekérése
	read -p "Ticket száma: " ticket_num
	
	is_logging_on
	
	sh_mgmt
	
	if [[ "$kafka_version" == "2.7.0" ]]; then
	
		choose_zookeeper
	else
		choose_broker
	fi
	
	validate_environment "$env"
	
	#read -p "Ticket száma: " ticket_num
	
	# Action választása
	printf "%s\n" \
	"Action lehetőségek: " \
	"${YEL}1. modify_or_add_rights" \
	"2. prefixed_producer_creation" \
	"3. producer_creation" \
	"4. consumer_creation (prefixed és nem prefixed)${NC}" \
	""
	
	read -p "Kérlek válassz egyet: " action
	
	case $action in
	1)
		read -p "Jogosultság (read, write, describe, idempotent_write): " operation
		
		IFS=$'\n' read -d '' -r -a data_simple < <(awk -F ';' 'NR>0 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		unset IFS
	
		for line in "${data_simple[@]}"; do
		topic="$(echo "$line" | awk -F ';' '{print $1}')"
		user="$(echo "$line" | awk -F ';' '{print $2}')"
		
		done
		
		chmod +x ${sh_file}
		
		log_zipper
		;;
		
	2|3|4)
		
		IFS=$'\n' read -d '' -r -a data_simple < <(awk -F ';' 'NR>0 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		unset IFS
	
		for line in "${data_simple[@]}"; do
		topic="$(echo "$line" | awk -F ';' '{print $1}')"
		user="$(echo "$line" | awk -F ';' '{print $2}')"
		
		done
		
		chmod +x ${sh_file}
		
		log_zipper
		;;
	
	*)
		echo "Hiba: nem adtál meg semmilyen eksönt!"
		xIT
		;;
	
	esac
}

function simple_csv_only_topics() {

	create_log_dir

	sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$csv_file"
	echo "${LBL}A ${csv_file_path} fájl beolvasva.${NC}"

	#get_kaf_ver

	#echo "${LBL}A cluster-en jelenleg futó Kafka verzió:${NC} ${YEL}$kafka_version${NC}"
	
	# Ticket számának bekérése
	read -p "Ticket száma: " ticket_num
	
	is_logging_on
	
	sh_mgmt
	
	if [[ "$kafka_version" == "2.7.0" ]]; then
	
		choose_zookeeper
	else
		choose_broker
	fi 
	
	validate_environment "$env"
	
	# Action választása
	printf "%s\n" \
	"Action lehetőségek: " \
	"${YEL}1. Jogosultság állítás" \
	"2. Producer létrehozás" \
	"3. Prefixed producer létrehozás" \
	"4. Topic létrehozás (default retention)" \
	"5. Topic létrehozás custom retention-el" \
	"6. Consumer létrehozás (prefixed és nem prefixed)" \
	"7. Topic partíció módosítás" \
	"8. Retention period módosítás${NC}" \
	""
	
	read -p "Kérlek válassz egyet: " action
	
	case $action in
	
	6)
		consumer_rel_inputs_simple_csv_ot
		;;
		
	2|3)
		producer_rel_inputs_simple_csv_ot
		;;
		
	1)
		modify_rights_inputs
		;;
		
	4|5|7|8)
		topic_only_inputs_simple_csv_ot
		
		validate_retention_period "$retention_period"
		
		# Day --> millisec konverzió
		day_to_ms_retention="$(( 86400000 * $retention_period ))"
		;;
	
	*)
		echo "Hiba: nem adtál meg semmilyen eksönt!"
		xIT
		;;
	
	esac
	
	IFS=$'\n' read -d '' -r -a data_simple_only_topics < <(awk -F ';' 'NR>0 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
	unset IFS

	for line in "${data_simple_only_topics[@]}"; do
	topic="$(echo "$line" | awk -F ';' '{print $1}')"
	
		if [[ -z "$topic" ]]; then
			break
		fi
	
	done
	
	chmod +x ${sh_file}
		
	log_zipper
}


# Complex .csv fájl van megadva

function complex_csv() {
	
	#declare -a sh_files=()
	
	create_log_dir
	
	#perl /home/kafka/kafka-admin-tool/convert_xls_to_csv.pl
	
	#csv_file=$(/home/kafka/kafka-admin-tool/convert_xls_to_csv.pl | grep -oP '###\K[\d,.]+(?=###)')
	
	# Ticket számának bekérése
	read -p "Ticket száma: " ticket_num
	
	is_logging_on
	
	sh_mgmt
	
	# Action választása
	printf "%s\n" \
	"Action lehetőségek: " \
	"${YEL}1. Topic létrehozása" \
	"2. Topic létrehozása custom retention-el" \
	"3. Consumer létrehozás" \
	"4. Prefixed consumer létrehozás" \
	"5. Producer létrehozás" \
	"6. Prefixed producer létrehozás" \
	"7. Jogosultság állítás (akár transactionalID-val)" \
	"8. Topic törlés" \
	"9. Jogosultság törlés" \
	"10. Retention módosítás" \
	"11. Partíció módosítás" \
	""
	
	read -p "Kérlek válassz egyet: " action
	echo ""
	
	case $action in
		
	1)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>3 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $8}')"
					partitions="$(echo "$line" | awk -F ';' '{print $9}')"
					
				else
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $9}')"
					partitions="$(echo "$line" | awk -F ';' '{print $10}')"
				fi
				
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] ;}; then
					continue
				fi
				
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}."
			create_topic >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			case $sheet_name in
			
			2)
			
			for line in "${data_complex[@]}"; do
				topic="$(echo "$line" | awk -F ';' '{print $1}')"
				replication_factor="$(echo "$line" | awk -F ';' '{print $2}')"
				partitions="$(echo "$line" | awk -F ';' '{print $3}')"
				retention_period="$(echo "$line" | awk -F ';' '{print $4}')"
				cluster="$(echo "$line" | awk -F ';' '{print $5}')"
			
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] || [[ -z "$retention_period" ]] || [[ -z "$cluster" ]] ;}; then
					#break
					continue
				fi
			
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}."
			create_topic >> "$sh_file"
			
			done
			;;
			
			1|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
		
	2)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		declare -i retention_period
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>3 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					retention_period="$(echo "$line" | awk -F ';' '{print $7}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $8}')"
					partitions="$(echo "$line" | awk -F ';' '{print $9}')"
					
				else
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					retention_period="$(echo "$line" | awk -F ';' '{print $8}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $9}')"
					partitions="$(echo "$line" | awk -F ';' '{print $10}')"
				fi
				
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] || [[ -z "$retention_period" ]] ;}; then
					continue
				fi
				
			validate_retention_period "$retention_period"
		
			# Day --> millisec konverzió
			day_to_ms_retention="$(( 86400000 * $retention_period ))"
			
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}, retention: ${GRE}$day_to_ms_retention${NC}."
			create_topic_with_retention >> "$sh_file"
			
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			2)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				topic="$(echo "$line" | awk -F ';' '{print $1}')"
				replication_factor="$(echo "$line" | awk -F ';' '{print $2}')"
				partitions="$(echo "$line" | awk -F ';' '{print $3}')"
				retention_period="$(echo "$line" | awk -F ';' '{print $4}')"
				cluster="$(echo "$line" | awk -F ';' '{print $5}')"
			
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] || [[ -z "$retention_period" ]] || [[ -z "$cluster" ]] ;}; then
					#break
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			validate_retention_period "$retention_period"
			
			# Day --> millisec konverzió
			day_to_ms_retention="$(( 86400000 * $retention_period ))"
			
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}, retention: ${GRE}$day_to_ms_retention${NC}."
			create_topic_with_retention >> "$sh_file"
			
			done
			;;
			
			1|*)
			work_options
			;;
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
			
	3)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>6 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in ${data_complex[@]}; do
				if [[ "$column_num" == "9" ]]; then
					user="$(echo "$line" | awk -F ';' '{print $1}')"
					topic_read="$(echo "$line" | awk -F ';' '{print $3}')"
					group_id="$(echo "$line" | awk -F ';' '{print $4}')"
					
				else
					user="$(echo "$line" | awk -F ';' '{print $1}')"
					topic_read="$(echo "$line" | awk -F ';' '{print $4}')"
					group_id="$(echo "$line" | awk -F ';' '{print $5}')"
				fi
				
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] || [[ -z "$group_id" ]] ;}; then
					continue
				fi
				
			echo "A(z) ${YEL}$user${NC} consumer fog létrejönni a ${GRE}$topic_read${NC} topic-on a ${GRE}$group_id${NC} consumer group-al."
			create_consumer_complex_csv >> "$sh_file"
			
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in ${data_complex[@]}; do
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic_read="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
			
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] || [[ -z "$group_id" ]] || [[ -z "$is_read" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
			
			echo "A(z) ${YEL}$user${NC} consumer fog létrejönni a ${GRE}$topic_read${NC} topic-on a ${GRE}$group_id${NC} consumer group-al."
			create_consumer_complex_csv >> "$sh_file"
			
			done
			;;
			
			2|*)
			work_options
			;;
			esac
			;;
			
		esac	
			
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
			
	4)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>6 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_read=$(echo "$line" | awk -F ';' '{print $3}')
					group_id_prefix=$(echo "$line" | awk -F ';' '{print $5}')
					
				else
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_read=$(echo "$line" | awk -F ';' '{print $4}')
					group_id_prefix=$(echo "$line" | awk -F ';' '{print $6}')
				fi
				
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] || [[ -z "$group_id_prefix" ]] ;}; then
					continue
				fi
			
			echo "A(z) ${GRE}$user${NC} consumer fog létrejönni a ${GRE}$topic_read${NC} topic-on a ${YEL}$group_id_prefix${NC} nevű prefixed consumer group-al."
			create_consumer_complex_csv >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic_read="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
				
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] || [[ -z "$group_id" ]] || [[ -z "$is_read" ]] || [[ -z "$is_prefixed" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
			
			echo "A(z) ${GRE}$user${NC} consumer fog létrejönni a ${GRE}$topic_read${NC} topic-on a ${YEL}$group_id${NC} nevű prefixed consumer group-al."
			create_consumer_complex_csv >> "$sh_file"
			
			done
			;;
			
			2|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
			
	5)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>6 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_write=$(echo "$line" | awk -F ';' '{print $6}')
					
				else
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_write=$(echo "$line" | awk -F ';' '{print $7}')
				fi
				
				if { [[ -z "$user" ]] || [[ -z "$topic_write" ]] ;}; then
					#break
					continue
				fi
			
			echo "A(z) ${YEL}$user${NC} producer fog létrejönni a ${YEL}$topic_write${NC} topic-on."
			create_producer_complex_csv >> "$sh_file"
			
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic_write="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
				
				if { [[ -z "$user" ]] || [[ -z "$topic_write" ]] || [[ -z "$group_id" ]] || [[ -z "$is_write" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
			
			echo "A(z) ${YEL}$user${NC} producer fog létrejönni a ${YEL}$topic_write${NC} topic-on."
			create_producer_complex_csv >> "$sh_file"
			
			done
			;;
			
			2|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
			
	6)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>6 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
		#unset IFS
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_write=$(echo "$line" | awk -F ';' '{print $6}')
					
				else
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_write=$(echo "$line" | awk -F ';' '{print $7}')
				fi	
				
				if { [[ -z "$user" ]] || [[ -z "$topic_write" ]] ;}; then
					#break
					continue
				fi
			
			echo "A(z) ${YEL}$user${NC} producer fog létrejönni a ${YEL}$topic_write${NC} prefixed topic-on."
			create_producer_complex_csv >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do	
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic_write="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
				
				if { [[ -z "$user" ]] || [[ -z "$topic_write" ]] || [[ -z "$is_write" ]] || [[ -z "$is_prefixed" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			echo "A(z) ${YEL}$user${NC} producer fog létrejönni a ${YEL}$topic_write${NC} prefixed topic-on."
			create_producer_complex_csv >> "$sh_file"
			
			done
			;;
			
			2|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
			
	7)
		start_time=$(date +%s)
		
		validate_environment "$env"
		
		echo ""
		
		printf "%s\n" \
	    "Jogosultság:" \
	    "1. read" \
	    "2. describe" \
	    "3. write" \
		"4. read + transactional_id" \
		"5. describe + transactional_id" \
		"6. write + transactional_id" \
		""
	    
		echo ""
	    
		read -p "Kérlek válassz egyet: " operation
		
		choose_broker
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
	
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
		
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_read=$(echo "$line" | awk -F ';' '{print $3}')
					topic_write=$(echo "$line" | awk -F ';' '{print $6}')
				else
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_read=$(echo "$line" | awk -F ';' '{print $4}')
					topic_describe=$(echo "$line" | awk -F ';' '{print $3}')
					topic_write=$(echo "$line" | awk -F ';' '{print $7}')
				fi
				
				case $operation in
				1)
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] ;}; then
					continue
				fi
				;;
				2)
				if { [[ -z "$user" ]] || [[ -z "$topic_describe" ]] ;}; then
					continue
				fi
				;;
				3)
				if { [[ -z "$user" ]] || [[ -z "$topic_write" ]] ;}; then
					continue
				fi
				;;
				esac
				
				echo "${YEL}A következő jogosultság hegesztés fog történni:${NC} user: ${GRE}$user${NC}, jogosultság: ${GRE}read${NC}"
			add_modify_rights_complex_csv >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
		
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do	
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
				
				
				case $operation in
				1)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$is_read" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				2)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$is_write" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				3)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$is_describe" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				4)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$is_read" ]] || [[ -z "$transactional_id" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				5)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$transactional_id" ]] || [[ -z "$is_describe" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				6)
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$is_write" ]] || [[ -z "$transactional_id" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				;;
				esac
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			echo "${YEL}A következő jogosultság hegesztés fog történni:${NC} user: ${GRE}$user${NC}, jogosultság: ${GRE}read${NC}"
			add_modify_rights_complex_csv >> "$sh_file"
		
			done
			;;
			
			2|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
	
	8)
		start_time=$(date +%s)
		
		if [[ "$kafka_version" == "2.7.0" ]]; then
		
			choose_zookeeper
		else
			choose_broker
		fi
		
		validate_environment "$env"
		
		echo ""
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $8}')"
					partitions="$(echo "$line" | awk -F ';' '{print $9}')"
					
				else
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $9}')"
					partitions="$(echo "$line" | awk -F ';' '{print $10}')"
				fi
				
				if [[ -z "$topic" ]]; then
					continue
				fi
				
			echo "A(z) ${YEL}$topic${NC} topic fog törlődni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}."
			delete_topic_complex_csv >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			case $sheet_name in
			
			2)
			
			for line in "${data_complex[@]}"; do
				topic="$(echo "$line" | awk -F ';' '{print $1}')"
				replication_factor="$(echo "$line" | awk -F ';' '{print $2}')"
				partitions="$(echo "$line" | awk -F ';' '{print $3}')"
				retention_period="$(echo "$line" | awk -F ';' '{print $4}')"
				cluster="$(echo "$line" | awk -F ';' '{print $5}')"
			
				if { [[ -z "$topic" ]] || [[ -z "$cluster" ]] ;}; then
					#break
					continue
				fi
			
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			echo "A(z) ${YEL}$topic${NC} topic fog törlődni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}."
			delete_topic_complex_csv >> "$sh_file"
			
			done
			;;
			
			1|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
	
	9)
		start_time=$(date +%s)
		
		validate_environment "$env"
		
		echo ""
		
		printf "%s\n" \
	    "${YEL}Törlendő jogosultság:${NC}" \
	    "1. read" \
	    "2. describe" \
	    "3. write" \
		"4. read + transactional_id" \
		"5. describe + transactional_id" \
		"6. write + transactional_id" \
		"7. consumer" \
		"8. producer" \
		"9. prefixed producer"
	    
		echo ""
	    
		read -p "Kérlek válassz egyet: " operation
		
		#case $right_2_delete in 
		choose_broker
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in

		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_read=$(echo "$line" | awk -F ';' '{print $3}')
					topic_write=$(echo "$line" | awk -F ';' '{print $6}')
				else
					user=$(echo "$line" | awk -F ';' '{print $1}')
					topic_describe=$(echo "$line" | awk -F ';' '{print $3}')
					topic_read=$(echo "$line" | awk -F ';' '{print $4}')
					topic_write=$(echo "$line" | awk -F ';' '{print $7}')
				fi
				
				if { [[ -z "$user" ]] || [[ -z "$topic_read" ]] || [[ -z "$topic_write" ]] || [[ -z "$topic_describe" ]] }; then
					continue
				fi
				
				echo "${YEL}A következő jogosultság kerül törlésre:${NC} user: ${GRE}$user${NC}, jogosultság: ${GRE}read${NC}"
			delete_rights_complex_csv >> "$sh_file"
		
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
		
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do	
				user="$(echo "$line" | awk -F ';' '{print $1}')"
				group_id="$(echo "$line" | awk -F ';' '{print $2}')"
				topic="$(echo "$line" | awk -F ';' '{print $3}')"
				is_read="$(echo "$line" | awk -F ';' '{print $5}')"
				is_write="$(echo "$line" | awk -F ';' '{print $6}')"
				is_describe="$(echo "$line" | awk -F ';' '{print $7}')"
				is_prefixed="$(echo "$line" | awk -F ';' '{print $8}')"
				cluster="$(echo "$line" | awk -F ';' '{print $9}')"
				transactional_id="$(echo "$line" | awk -F ';' '{print $4}')"
				
				if { [[ -z "$user" ]] || [[ -z "$topic" ]] || [[ -z "$cluster" ]] ;}; then
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] ;}; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] ;}; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] ;}; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] ;}; then
					continue
				fi
		
			echo "${YEL}A következő jogosultság hegesztés fog történni:${NC} user: ${GRE}$user${NC}, jogosultság: ${GRE}read${NC}"
			delete_rights_complex_csv >> "$sh_file"
		
			done
			;;
			
			2|*)
			work_options
			;;
			
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."  # A futási idő kiiratása
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
	
	10|11)
		start_time=$(date +%s)
		
		choose_broker
		
		validate_environment "$env"
		
		echo ""
		
		declare -i retention_period
		
		printf "%s\n" \
		"${YEL}Melyik excel template feldolgozást választod?" \
		"1. Régi template" \
		"2. Új (SNOW form módosítással bevezetésre kerülő template)${NC}" \
		""
		
		read -p "Válasz: " answer
		
		case $answer in
		
		1)
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
	
			echo "${LBL}A ${selected_csv_file} fájl beolvasva.${NC}"
			
			# CSV fájl mezőinek megszámlálása
			column_num=$(awk '{print NF}' /home/kafka/kafka-admin-tool/ticketek/$selected_csv_file | sort -nu | tail -n 1)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				if [[ "$column_num" == "9" ]]; then
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					retention_period="$(echo "$line" | awk -F ';' '{print $7}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $8}')"
					partitions="$(echo "$line" | awk -F ';' '{print $9}')"
					
				else
					topic="$(echo "$line" | awk -F ';' '{print $2}')"
					retention_period="$(echo "$line" | awk -F ';' '{print $8}')"
					replication_factor="$(echo "$line" | awk -F ';' '{print $9}')"
					partitions="$(echo "$line" | awk -F ';' '{print $10}')"
				fi
				
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] || [[ -z "$retention_period" ]] }; then
					continue
				fi
				
			validate_retention_period "$retention_period"
		
			# Day --> millisec konverzió
			#day_to_ms_retention="$(( 86400000 * $retention_period ))"

			retention_check_and_convert
			
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}, retention: ${GRE}$day_to_ms_retention${NC}."
			modify_retention_no_csv >> "$sh_file"
			
			done
			;;
			
		2)
			python3 /home/kafka/kafka-admin-tool/convert_xls_2_csv.py
			
			echo ""
			echo "Belépés a ${LBL}$ticket_dir${NC} mappába..."
			sleep 0.5
					
			cd "$ticket_dir" && pwd && ls -alh
			
			read -p "Kérlek válaszd ki a .csv fájlodat: " selected_csv_file
			
			sed -i 's/\r//g' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file"
			
			echo ""
			printf "%s\n" \
			"Munkafüzet neve: " \
			"1. Tömeges ACL igénylés" \
			"2. Tömeges Topic igénylés" \
			""
			read -p "Válassz egyet: " sheet_name
			echo ""
			
			case $sheet_name in
			
			2)
			
			IFS=$'\n' read -d '' -r -a data_complex < <(awk -F ';' 'NR>1 {print $0}' "/home/kafka/kafka-admin-tool/ticketek/$selected_csv_file")
			unset IFS
			
			for line in "${data_complex[@]}"; do
				topic="$(echo "$line" | awk -F ';' '{print $1}')"
				replication_factor="$(echo "$line" | awk -F ';' '{print $2}')"
				partitions="$(echo "$line" | awk -F ';' '{print $3}')"
				retention_period="$(echo "$line" | awk -F ';' '{print $4}')"
				cluster="$(echo "$line" | awk -F ';' '{print $5}')"
			
				if { [[ -z "$topic" ]] || [[ -z "$partitions" ]] || [[ -z "$replication_factor" ]] || [[ -z "$retention_period" ]] || [[ -z "$cluster" ]] }; then
					#break
					continue
				fi
				
				if { [[ "$env" == "dv" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "DEV" ]] }; then
					continue
				elif { [[ "$env" == "ua" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "UAT" ]] }; then
					continue
				elif { [[ "$env" == "pp" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PREPROD" ]] }; then
					continue
				elif { [[ "$env" == "pr" ]] && [[ ! -z "$cluster" ]] && [[ "$cluster" != "PROD" ]] }; then
					continue
				fi
		
			validate_retention_period "$retention_period"
			
			# Day --> millisec konverzió
			#day_to_ms_retention="$(( 86400000 * $retention_period ))"

			retention_check_and_convert
			
			echo "A(z) ${YEL}$topic${NC} topic fog létrejönni, partíciók száma: ${GRE}$partitions${NC}, rep. faktor: ${GRE}$replication_factor${NC}, retention: ${GRE}$day_to_ms_retention${NC}."
			modify_topic_partitions >> "$sh_file"
			
			done
			;;
			
			1|*)
			work_options
			;;
			esac
			;;
		esac
		
		sh_files+=("$sh_file")
		
		log_zipper
		
		echo ""
		
		end_time=$(date +%s)  # Aktuális idő újbóli lekérése másodpercben
		echo "A script futási ideje: ${YEL}$(($end_time-$start_time))${NC} másodperc."
		echo "Létrejött a ticket számával ellátott .sh fájl benne a futtatandó kafka parancsokkal: ${LBL}$sh_file${NC}"
		echo "A log fájl: ${LBL}${log_file}${NC}"
		
		echo ""
		
		exit_or_restart_or_new_task
		;;

	*)
		echo "${RED}Hiba: nem adtál meg semmilyen eksönt!${NC}"
		#exit 1
		
		echo ""
		
		exit_or_restart_or_new_task
		;;
		
	esac
}